<?php

namespace App\Http\Controllers;

use App\Models\Categoria;
use App\Models\Marca;
use App\Models\Producto;
use Illuminate\Support\Facades\DB;
use App\Models\fmd;
use App\Models\Subcategoria;
use Illuminate\Http\Request;

class WPController extends Controller
{
    public function wpxalapa(){
        set_time_limit(0);
        $data['productos'] = Producto::Join('margenes_por_producto', 'margenes_por_producto.clave_ct', '=', 'productos.clave_ct')
                ->join('categorias', 'categorias.id', '=', 'productos.categoria_id')
                ->join('subcategorias', 'subcategorias.id', '=', 'productos.subcategoria_id')
                ->join('existencias', 'existencias.clave_ct', '=', 'productos.clave_ct')
                ->where('productos.estatus', 'Activo')
                ->where('existencias.almacen_id', '=', 15)
                ->where('existencias.existencias', '>', 0)
                // ->where('productos.clave_ct', '=', [])
                ->get(
                    [
                    'productos.clave_ct',
                    'productos.nombre',
                    'productos.descripcion_corta',
                    'categorias.nombre as categoria',
                    'subcategorias.nombre as subcategoria',
                    'productos.precio_unitario',
                    'productos.enlace',
                    'productos.imagen',
                    //'productos.existencias',
                    'productos.precio_unitario',
                    'existencias.almacen_id as almacen',
                    'existencias.existencias as existencias',
                    'margenes_por_producto.margen_utilidad as margen'
                ]
            );
        return view('wp.productosXalapa', compact('data'));
    }

    public function pruebas(){
        set_time_limit(0);
        $data['productos'] = 
        Producto::Join('margenes_por_producto', 'margenes_por_producto.clave_ct', '=', 'productos.clave_ct')
        // DB::SELECT("SELECT existencias.clave_ct, productos.nombre, productos.descripcion_corta, categorias.nombre as categoria , subcategorias.nombre as subcategoria, productos.precio_unitario, productos.enlace, productos.imagen, productos.existencias, productos.precio_unitario, margenes_por_producto.margen_utilidad as margen FROM existencias inner join productos on productos.clave_ct=existencias.clave_ct INNER JOIN categorias ON categorias.id  = productos.categoria_id INNER JOIN subcategorias ON subcategorias.id = productos.subcategoria_id INNER JOIN margenes_por_producto ON margenes_por_producto.clave_ct = productos.clave_ct where existencias.clave_ct not in ('ACCACO010','ACCACO020','ACCACO030','ACCACT110','ACCACT3140','ACCACT3520','ACCACT4080','ACCACT4090','ACCACT4110','ACCACT4120','ACCACT4130','ACCACT4140','ACCACT4150','ACCACT4160','ACCACT4170','ACCACT4180','ACCACT4190','ACCACT4200','ACCACT4230','ACCACT4240','ACCACT4260','ACCACT4270','ACCACT4280','ACCAZR040','ACCAZR220','ACCAZR260','ACCAZR320','ACCAZR740','ACCBAC130','ACCBAC1790','ACCBAC2380','ACCBAC2390','ACCBAC2410','ACCBAC2420','ACCBAC3530','ACCBAC3550','ACCBAC3560','ACCBEL160','ACCBEL380','ACCBIC040','ACCBIC050','ACCBIT130','ACCBIT140','ACCBIT150','ACCBIT160','ACCBIT190','ACCBLC220','ACCBLR040','ACCBLR050','ACCCDM1010','ACCCDM1080','ACCCDM1210','ACCCDM1230','ACCCDM970','ACCDAH520','ACCDAH560','ACCDAH650','ACCDAH800','ACCDAT1410','ACCDAT1460','ACCDAT1480','ACCDAT1600','ACCDAT440','ACCDIE010','ACCDIX050','ACCEST2460','ACCEZV070','ACCEZV100','ACCGEN300','ACCGEN370','ACCGEN400','ACCHPI3420','ACCHPI920','ACCHPQ050','ACCITL1055','ACCITL1165','ACCITL1430','ACCITL1455','ACCITL1500','ACCITL1635','ACCITL1990','ACCITL200','ACCITL2060','ACCITL2360','ACCITL2450','ACCITL2570','ACCITL2940','ACCITL300','ACCITL320','ACCITL3430','ACCITL3460','ACCITL3860','ACCITL4100','ACCITL420','ACCITL4400','ACCITL540','ACCITL595','ACCITL920','ACCJAN070','ACCKNS020','ACCKSA010','ACCKSA040','ACCLCS230','ACCMST1060','ACCMST1070','ACCMST1350','ACCMST1680','ACCMST2220','ACCMST3550','ACCMST4010','ACCMST4490','ACCMST4560','ACCNCB010','ACCNCB020','ACCNCB070','ACCNCB1000','ACCNCB1100','ACCNCB1130','ACCNCB1160','ACCNCB1170','ACCNCB1210','ACCNCB1220','ACCNCB160','ACCNCB170','ACCNCB210','ACCNCB220','ACCNCB350','ACCNCB480','ACCNCB780','ACCNCB790','ACCNCB850','ACCNCB930','ACCNCB940','ACCNCB950','ACCNCB960','ACCNCB990','ACCNNN040','ACCNNN050','ACCNNN060','ACCNNN070','ACCNNN080','ACCNNN090','ACCNNN100','ACCNNN110','ACCNSY010','ACCNSY020','ACCNSY180','ACCNTE120','ACCNTE130','ACCNTE140','ACCNTE190','ACCORB060','ACCORB110','ACCOVL020','ACCOVL030','ACCOVL040','ACCOVL050','ACCOVL070','ACCOVL080','ACCOVL360','ACCOVL390','ACCOVL600','ACCOVL610','ACCOVL630','ACCOVL640','ACCOVL680','ACCOVL760','ACCOVL880','ACCOVL890','ACCPCM020','ACCPCM1160','ACCPCM150','ACCPCM170','ACCPCM180','ACCPCM200','ACCPCM220','ACCPCM480','ACCPNT670','ACCPTS1520','ACCPTS1530','ACCPVS040','ACCPVS150','ACCPVS220','ACCPVS240','ACCPVS260','ACCPVS360','ACCPVS430','ACCPVS440','ACCPVS460','ACCPVS530','ACCPVS540','ACCRBT040','ACCRBT1770','ACCRBT2330','ACCRBT2440','ACCRBT2480','ACCRBT3160','ACCRBT3540','ACCRBT3550','ACCRBT4560','ACCRBT4910','ACCRBT5690','ACCRBT6130','ACCRBT6240','ACCRBT6460','ACCRBT6900','ACCRBT7000','ACCRBT7260','ACCRBT820','ACCRBT910','ACCRBT940','ACCSTY340','ACCTCH5530','ACCTCH8150','ACCTCH8180','ACCTPL060','ACCTPL200','ACCTPL350','ACCTRL610','ACCTYM020','ACCVGO050','ACCVGO1350','ACCVGO1810','ACCVGO2140','ACCVGO2160','ACCVGO2200','ACCVGO2320','ACCVGO2330','ACCVGO760','ACCXRX1070','ACPMER010','ACPTND110','ACPTPL150','ACPTPL290','ACPTPL320','ACPTPL350','ACPTPL360','ACPTPL370','ACPTPL380','ACPTPL400','ACPTPL460','AIOHPI950','ANTUBI340','BATCDP020','BATCDP030','BATCDP080','BATDAT360','BATDTS020','BATDTS050','BATDTS070','BATOVL1150','BATOVL890','BATOVL950','BATOVL960','BATVIC040','BATVIC110','BOCACT110','BOCACT120','BOCBLR030','BOCBLR060','BOCGEN025','BOCGEN300','BOCGEN3300','BOCGEN3530','BOCGEN3540','BOCGEN3610','BOCGEN3620','BOCGET240','BOCGET320','BOCHIG010','BOCHIG030','BOCITL1080','BOCLFA090','BOCLNX080','BOCLOG1450','BOCLOG1810','BOCLOG700','BOCMST2210','BOCMST2780','BOCMST2840','BOCMST2850','BOCMST2870','BOCMST2900','BOCMST3100','BOCMST3140','BOCMST3340','BOCMST3420','BOCMST3450','BOCMST3520','BOCNCB260','BOCNCB520','BOCNCB530','BOCNCB590','BOCNCB600','BOCNCB610','BOCNCB620','BOCNCB630','BOCNCB650','BOCNCB660','BOCNCB680','BOCNCB690','BOCNCB700','BOCNCB710','BOCNCB730','BOCNCB740','BOCNCB750','BOCNCB760','BOCNCB770','BOCNCB780','BOCNCB790','BOCNNN050','BOCNNN250','BOCNNN290','BOCNNN630','BOCNNN640','BOCNNN650','BOCNNN670','BOCNNN680','BOCRBT670','BOCTCH2850','BOCTCH2890','BOCVGO1160','BOCVGO300','BOCVGO340','BOCVGO470','BOCVGO560','BOCVGO890','CABACT1020','CABACT1040','CABACT1050','CABACT870','CABDAT090','CABDAT180','CABDAT210','CABITL010','CABITL060','CABITL065','CABITL070','CABITL080','CABITL090','CABITL100','CABITL1025','CABITL1100','CABITL115','CABITL1255','CABITL1295','CABITL1465','CABITL1520','CABITL170','CABITL1790','CABITL180','CABITL195','CABITL1975','CABITL2045','CABITL2330','CABITL255','CABITL275','CABITL280','CABITL300','CABITL350','CABITL370','CABITL3790','CABITL4140','CABITL415','CABITL720','CABNCB010','CABNCB020','CABNCB390','CABNCB400','CABNCB470','CABNCB480','CABUSB010','CABVGO220','CABVGO490','CABVGO750','CABVGO820','CAMACT470','CAMDAH1080','CAMDAH1320','CAMDAH1520','CAMDAH2150','CAMDAH2320','CAMDAH2550','CAMDAH2610','CAMDAH2630','CAMDAH2720','CAMDAH2810','CAMDAH2900','CAMDAH3170','CAMDAH3450','CAMDAH3490','CAMDAH3650','CAMDAH3690','CAMDAH3740','CAMEZV170','CAMEZV280','CAMEZV380','CAMHLK410','CAMMSF230','CAMNCB040','CAMPVS1850','CAMPVS2200','CAMPVS2500','CAMPVS2540','CAMPVS2580','CAMPVS2590','CAMPVS2670','CAMPVS2770','CAMTPL180','CAMTPL190','CARBRT010','CARBRT1000','CARBRT165','CARBRT175','CARBRT1870','CARBRT205','CARBRT2050','CARBRT2120','CARBRT2320','CARBRT2330','CARBRT2880','CARBRT3060','CARBRT3070','CARBRT3080','CARBRT3090','CARBRT3270','CARBRT3280','CARBRT3300','CARBRT3360','CARBRT3370','CARBRT3380','CARBRT3390','CARBRT340','CARBRT3510','CARBRT3540','CARBRT3600','CARBRT3650','CARBRT3840','CARBRT470','CARCNN1810','CARCNN4700','CARCNN4710','CARCNN4720','CARCNN4730','CARCNN6180','CARCNN6440','CARCNN6450','CAREPS2580','CAREPS280','CAREPS3900','CAREPS3910','CAREPS3920','CAREPS3930','CAREPS4010','CAREPS4020','CAREPS4030','CAREPS4040','CAREPS4050','CAREPS4060','CAREPS4370','CAREPS4450','CAREPS4740','CAREPS4750','CAREPS5570','CAREPS5580','CAREPS5600','CAREPS5820','CAREPS5830','CAREPS5840','CAREPS5850','CAREPS5910','CAREPS6210','CAREPS6240','CAREPS810','CAREPS940','CARHPD3270','CARHPD3280','CARHPD3290','CARHPD3300','CARHPD3540','CARHPD4910','CARHPD4920','CARHPD4930','CARHPP3220','CARHPP3230','CARHPP3240','CARHPP4170','CARXRX3750','CARXRX5800','CDRASS120','CDRDLL040','CDRWCB040','CDRWCB125','CDRWCB1485','CDRWCB1560','CDRWCB1730','CDRWCB1750','CJNECL060','CJNEVO010','CJNFRT030','CJNTCH010','CJNTCH020','CJSQIA030','COMACR8950','COMASS7710','COMDEL7410','COMDEL9340','COMHYU200','COMHYU220','COMHYU240','COMLEV2290','COMLNX850','CPUAMD2200','CPUAMD2290','CPUDEL4850','CPUDEL5340','CPUINT3500','CPUINT3760','CPUINT3780','CPUINT4070','CPUINT4170','CPUINT4310','DDUACR080','DDUBLC1140','DDUBLC1150','DDUBLC1160','DDUDAT1010','DDUDAT1020','DDUDAT1030','DDUDAT1290','DDUDAT1300','DDUDAT1310','DDUDAT1410','DDUDAT1430','DDUDAT1590','DDUDAT1710','DDUDAT1800','DDUDAT230','DDUDAT320','DDUDAT450','DDUDAT460','DDUDAT520','DDUDAT700','DDUDAT830','DDUDAT850','DDUDAT870','DDUDAT880','DDUGIG100','DDUHKV050','DDUHPE1100','DDUHPO280','DDUHPO320','DDUHPO330','DDUHYU090','DDUHYU100','DDUHYU110','DDUHYU120','DDUKGT1290','DDUKGT1300','DDUKGT1360','DDUKGT2200','DDUKGT2210','DDUSAN430','DDUSAT1090','DDUSAT1150','DDUSAT250','DDUSAT260','DDUSAT570','DDUSAT710','DDUSAT830','DDUSGT1010','DDUSGT1080','DDUSGT1110','DDUSGT1170','DDUSGT1190','DDUSGT1240','DDUSGT1450','DDUSGT1540','DDUWSD1230','DDUWSD1560','DDUWSD1690','DDUWSD1730','DDUWSD1740','DDUWSD1780','DDUWSD1850','DDUWSD1860','DDUWSD1880','DDUWSD1920','DDUWSD1930','DDUWSD1960','DDUWSD2020','DDUXPG010','DDUXPG050','GABACT010','GABACT020','GABACT030','GABACT050','GABACT070','GABACT120','GABACT140','GABACT160','GABACT180','GABBLR030','GABEVO150','GABEVO170','GABEVO290','GABEVO300','GABEVO360','GABEVO420','GABEVO430','GABEVO460','GABGEN125','GABGEN1950','GABGEN2200','GABGEN2340','GABGEN2360','GABGEN2630','GABGEN865','GABGEN960','GABNCB050','GABNCB060','GABNCB090','GABNCB100','GABNCB110','GABVGO010','GRDDAH880','GRDDAH890','GRDDAH910','GRDDAH920','GRDDAH940','GRDDAH960','GRDPVS820','GRDPVS830','GRDPVS840','IMPCNN2180','IMPCNN2250','IMPCNN2280','IMPECL290','IMPEPS3300','IMPEPS3560','IMPEPS3570','IMPEPS3580','IMPEPS3600','IMPEPS3630','IMPEVO010','IMPEVO020','IMPHPI3090','IMPMTB920','IMPMTB930','IMPMTB940','IMPNTE020','IMPSMP780','IMPSMP820','IMPTCH010','IMPTCH020','IMPTCH030','IMPTCH050','IMPZBR2600','IPDMAC4540','KITACT630','KITBLR050','KITBLR070','KITDAH380','KITDAH500','KITDAH510','KITDLL1160','KITITL020','KITKBZ010','KITLOG380','KITLOG390','KITLOG410','KITMSF040','KITMST1060','KITMST1070','KITMST1090','KITMST1290','KITMST1310','KITMST1350','KITNCB010','KITNCB020','KITNCB030','KITNCB050','KITNCB060','KITNCB100','KITNCB120','KITNCB140','KITNCB150','KITNCB160','KITNCB170','KITNCB180','KITNNN010','KITNNN020','KITPVS370','KITTCH240','KITTPL240','LCDBFT040','LCTMTR1920','LCTMTR920','LCTSYB010','LCTSYB020','LCTTCH010','LCTTCH020','MALDLL320','MALDLL490','MALDLL530','MALGEN3910','MALGEN3930','MALGEN3940','MALGEN3950','MALGEN3990','MALGEN4010','MALGEN4020','MALGEN4030','MALHPI050','MALNCB080','MALNCB090','MALTCH090','MALTRG010','MBDASS5390','MBDECS2170','MBDGIG4600','MBDINT4000','MBDMSI1700','MEMACR010','MEMACR020','MEMACR040','MEMACR580','MEMACR590','MEMBLC1260','MEMBLC1270','MEMBLC1280','MEMDAT1380','MEMDAT1850','MEMDAT2220','MEMDAT2380','MEMDAT2390','MEMDAT2400','MEMDAT2630','MEMDAT3040','MEMDAT4340','MEMDAT4820','MEMDAT4830','MEMDAT4860','MEMDAT5710','MEMDAT5850','MEMDAT5890','MEMDAT5900','MEMDAT5910','MEMDAT5960','MEMDAT5970','MEMDAT5980','MEMDAT6000','MEMDAT6030','MEMDAT6070','MEMDAT6090','MEMDAT6130','MEMDAT6370','MEMDAT6490','MEMHKV110','MEMHPO070','MEMHPO090','MEMHPO110','MEMHPO170','MEMHYU030','MEMHYU390','MEMKGN1160','MEMKGN1890','MEMKGN1900','MEMKGN2180','MEMKGN2200','MEMKGN2290','MEMKGN2790','MEMKGN2800','MEMKGN2810','MEMKGN2840','MEMKGN2860','MEMKGN2870','MEMKGN2910','MEMKGN2970','MEMKGN3550','MEMKGN3590','MEMKGN3640','MEMKGN3650','MEMKGN3670','MEMKGN3750','MEMSAN1090','MEMSAN1330','MEMSAN1340','MEMSTY100','MENWSD010','MICBLR010','MONACR1500','MONACR1580','MONACR1600','MONAOC680','MONBNQ1320','MONDLL1820','MONDLL880','MONHPI300','MONHPI440','MONHPI460','MONLGE1680','MONLGE2400','MONLGE2410','MONLGE2460','MONLGE2580','MONLNX130','MONLNX150','MONNCB010','MONNCB020','MONNCB040','MONNCB050','MONNCB060','MONNTE010','MONQIA160','MONQIA190','MONVGO080','MOUACT120','MOUACT140','MOUDLL020','MOUGEN1880','MOUHPI040','MOULOG1230','MOULOG1320','MOULOG1570','MOULOG1580','MOULOG1770','MOUMST1110','MOUMST1150','MOUMST1430','MOUMST1440','MOUMST1570','MOUMST1580','MOUMST1590','MOUMST1630','MOUNCB150','MOUNCB260','MOUNCB340','MOUNCB350','MOUNCB380','MOUNCB400','MOUNCB430','MOUNCB440','MOUNCB450','MOUNCB490','MOUNCB500','MOUNCB510','MOUNCB520','MOUNCB530','MOUTCH250','MOUTCH720','MOUTCH780','MOUTCH790','MOUTCH810','MOUVGO240','MOUVGO560','MTFHPI1345','MTFHPI1545','NBKBIT010','NBKBIT020','NBKBIT170','NBKBIT180','NBKBIT200','NBKBIT220','NBKCDP1520','NBKCDP1530','NBKCOM270','NBKCOM290','NBKCYP1130','NBKCYP1150','NBKCYP1170','NBKCYP900','NBKCYP910','NBKCYP920','NBKKBZ410','NBKSBA030','NBKTRL110','NBKTRL2040','NBKTRL2520','NBKVIC200','NBKVIC370','NBKVIC390','PANHSE1120','PANHSE1340','PANHSE1350','PANLGE3160','PAPXRX080','PAPXRX090','PROBNQ2050','PROLMP470','RCKACC070','RCKACC1210','RCKACC1220','RCKACC1230','RCKACC1390','RCKACC1430','RCKACC1450','RCKACC1510','RCKACC165','RCKACC1700','RCKACC500','RCKACC510','RCKACC560','RCKRBT020','REGBIT010','REGBIT030','REGBIT080','REGCDP1030','REGCDP1040','REGCDP1070','REGCOM140','REGCOM230','REGCOM250','REGCYP020','REGFZA030','REGFZA050','REGKBZ070','REGKBZ200','REGKBZ230','REGKBZ240','REGNCB010','REGNSY010','REGSBA110','REGVIC070','RIBEVL210','RIBEVL620','ROUASS340','ROUMER080','ROUMER090','ROUTND220','ROUTND400','ROUTND430','ROUTPL120','ROUTPL560','ROUTPL710','ROUTPL900','ROUTPL960','ROUTPL970','ROUTPL990','SCACNN490','SCAEVO020','SLXLMP020','SLXLMP030','SLXLMP090','SLXLMP120','SLXLMP130','SLXLMP150','SLXLMP200','SLXLMP240','SLXLMP250','SLXLMP320','SLXLMP370','SLXLMP520','SLXLMP530','SOFAPL2920','SOFAPL2930','SOFAPL4640','SOFAVZ540','SOFBIT1320','SOFBIT1330','SOFBIT1340','SOFBIT1350','SOFBIT1370','SOFBIT1380','SOFBIT1390','SOFBIT1400','SOFBIT1410','SOFBIT890','SOFBIT900','SOFDES160','SOFEST2040','SOFEST2060','SOFHPE640','SOFING310','SOFKPK7710','SUPBIT010','SUPKBZ140','SWTDAH150','SWTLNK890','SWTMER010','SWTMER020','SWTMER030','SWTMER040','SWTTPL010','SWTTPL020','SWTTPL030','SWTTPL120','SWTTPL130','SWTTPL155','SWTTPL210','SWTTPL270','SWTTPL390','SWTTPL600','SWTTPL670','SWTTPL690','SWTTPL720','SWTTPL730','SWTTPL750','SWTTPL760','SWTTPL840','SWTTPL860','TABACT010','TABLEN1150','TABSMG210','TARITL710','TARITL790','TARMER020','TARMER040','TARTPL180','TARTPL200','TARTPL340','TARTPL370','TARTPL380','TARTPL410','TARTPL440','TARTPL570','TARTPL590','TECACT060','TECBFT1680','TECBFT240','TECDLL040','TECDLL080','TECLOG1110','TECLOG250','TECLOG590','TECMSF190','TECMST1000','TECMST820','TECMST950','TECMST990','TECNCB030','TECNCB040','TECNCB080','TECVGO280','TECYEY150','TELGDM130','TELPAN080','TELPAN085','TELPAN090','TELPAN095','TELPAN100','TELPAN105','TELPAN135','TERKSA020','TERYOB010','TLCHYU330','TLCNNN090','TLCNNN210','TLCVGO650','TONDLL1070','TONHPP3710','TONHPP3730','TONHPS140','TONHPS190','TONHPS310','TVIASS2990','TVIGIG2090','TVIGIG2710','VENBLR020','VENBLR040','VENNCB020','VENNCB040','VENNCB050','VENNCB090','VENNCB100','VENNCB110','VENNCB120','VENNCB130','VENNCB140','VENRBT080') and productos.estatus='Activo' group by existencias.clave_ct, productos.nombre, productos.descripcion_corta, categorias.nombre, subcategorias.nombre, productos.precio_unitario, productos.enlace, productos.imagen, productos.existencias, margenes_por_producto.margen_utilidad LIMIT 4500,500;");
        // ->Join('propductos','productos.clave_ct', '=', 'existencias.clave_ct')
        // Join('margenes_por_producto', 'margenes_por_producto.clave_ct', '=', 'productos.clave_ct')
                ->join('categorias', 'categorias.id', '=', 'productos.categoria_id')
                ->join('subcategorias', 'subcategorias.id', '=', 'productos.subcategoria_id')
                ->whereNotIn('productos.clave_ct',  Producto::join('existencias', 'existencias.clave_ct', '=', 'productos.clave_ct')
                    ->where('productos.estatus', 'Activo')
                    ->where('existencias.almacen_id', '=', 15)
                    ->where('existencias.existencias', '>', 0)
                    ->get(
                        'productos.clave_ct'
                    )
                )
                // ->where('productos.estatus', 'Activo')
                // ->where('productos.existencias', '>', 0)
                ->get(
                    [
                    'productos.clave_ct',
                    'productos.nombre',
                    'productos.descripcion_corta',
                    'categorias.nombre as categoria',
                    'subcategorias.nombre as subcategoria',
                    'productos.precio_unitario',
                    'productos.enlace',
                    'productos.imagen',
                    'productos.existencias',
                    'productos.precio_unitario',
                    'margenes_por_producto.margen_utilidad as margen'
                ]
            );
           //dd(count($data['productos']));
        return view('wp.productosXalapa', compact('data'));
    }
}